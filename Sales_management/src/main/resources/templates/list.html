<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title>売上管理システム</title>
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<link href="/css/list.css" rel="stylesheet"></link>
<meta charset="utf-8" />
</head>
<body>
	<h3>製造部売上管理システム:案件一覧</h3>
	<form th:action="@{/listsearch}">
		<div class="pulldown_kensaku">
			<table class="pulldown">
				<tr>
					<th>顧客:</th>
					<td><select class="parent" id="customoer" name="customer_name">
							<option value="" selected="selected">顧客を選択</option>
							<option value="ビールシステム">ビールシステム</option>
							<option value="ABC">ABC</option>
							<option value="昭和製作所">昭和製作所</option>
					</select></td>
				</tr>
				<tr>
					<th class="cell_title">ステータス :</th>
					<td><select class="children" id="status" name="status"
						disabled>
							<option value="" selected="selected">ステータスを選択</option>
							<option value="引合い" data-val="ビールシステム">引合い</option>
							<option value="見積済み" data-val="ビールシステム">見積済み</option>
							<option value="受注" data-val="ビールシステム">受注</option>
							<option value="失注" data-val="ビールシステム">失注</option>
							<option value="製造着手" data-val="ビールシステム">製造着手</option>
							<option value="製造完了" data-val="ビールシステム">製造完了</option>
							<option value="納品済み" data-val="ビールシステム">納品済み</option>
							<option value="検収済み" data-val="ビールシステム">検収済み</option>
							<option value="請求済み" data-val="ビールシステム">請求済み</option>
							<option value="受注" data-val="ABC">受注</option>
							<option value="失注" data-val="ABC">失注</option>
							<option value="製造" data-val="ABC">製造</option>
							<option value="保管" data-val="ABC">保管</option>
							<option value="納品" data-val="ABC">納品</option>
							<option value="請求" data-val="ABC">請求</option>
							<option value="発注書受領" data-val="昭和製作所">発注書受領</option>
							<option value="仕掛中" data-val="昭和製作所">仕掛中</option>
							<option value="納品書提出" data-val="昭和製作所">納品書提出</option>
							<option value="受入書受領" data-val="昭和製作所">受入書受領</option>
							<option value="請求書提出" data-val="昭和製作所">請求書提出</option>
							<option value="失注" data-val="昭和製作所">失注</option>
					</select></td>
				</tr>
			</table>
		</div>
		<div class="kensakucategory">
			<h4>件名：</h4>
		</div>
		<div class="kensaku">

			<table class="list">
				<tr>
					<th><input id="Serch_subject" class="kensaku-txt" type="text"
						name="Serch_subject" value=""></th>
				</tr>

				<tr>

					<th bgcolor=#808080><button type="submit" class="btn-kensaku">検索</button></th>
				</tr>

			</table>

		</div>
		<!-- <div>
		<button type="submit" class="btn-kensaku">検索</button>
		</div> -->

	</form>
	<form th:action="@{/add}">
		<button type="submit" class="btn-sinki">新規登録</button>
	</form>
	<br>
	<br>
	<div class="list_table">
		<table class="list">
			<thead>
				<tr class="jyusyoroku_list">
					<th>No.</th>
					<th>顧客</th>
					<th>受注日</th>
					<th>S番号</th>
					<th>件名</th>
					<th>数量</th>
					<th>納入指定日<br>/納入日
					</th>
					<th>請求日</th>
					<th>見積金額<br>/受注金額
					</th>
					<th>ステータス</th>
					<th colspan="2">&emsp;&emsp;</th>
				</tr>
			</thead>

			<tbody>
				<tr th:each="customlist,list : ${customerlist}">
					<td class="center" th:text="${list.count}"></td>
					<td class="name" th:text="${customlist.customer_name}"></td>
					<td class="name" th:text="${customlist.orderdate}"></td>
					<td class="tel" th:text="${customlist.s_number}"></td>
					<td class="tel" th:text="${customlist.subject}"></td>
					<td class="tel" th:text="${customlist.quantity}"></td>
					<td class="tel">[[${customlist.delivery_designation}]]<br>[[${customlist.delivery_date}]]
					</td>
					<td class="tel">[[${customlist.billing_date}]]</td>
					<td class="tel">[[${customlist.estimated_money}]]<br>[[${customlist.Order_money}]]
					</td>
					<td class="tel" th:text="*{customlist.status}"></td>
					<td bgcolor=#808080>
						<form th:action="@{/edit/{id}(id=*{customlist.id})}">
							<button type="submit" class="btn-edit-delete">編集</button>
						</form>
					</td>
					<td bgcolor=#808080>
						<form th:action="@{/delete/{id}(id=*{customlist.id})}">
							<button type="submit" class="btn-edit-delete">削除</button>
						</form>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
	<script th:inline="javascript">
	$(function() {

		var $children = $('.children'); //ステータスの要素を変数に入れます。

		var original = $children.html(); //後のイベントで、不要なoption要素を削除するため、オリジナルをとっておく



		// 顧客名の情報を受け取る
		var alertStr2 = /*[[${searchRequest.customer_name}]]*/


		if(typeof alertStr2 != 'object' && alertStr2 != "") {
			document.getElementById('customoer').value =  alertStr2; // 顧客名のプルダウンに取得した値を入れる
			 var val1 = alertStr2;

			  //ここから下と同じ処理
			 $children.html(original).find('option').each(function() {
			    var val2 = $(this).data('val');

			    if (val1 != val2) {
			   	 $(this).not(':first-child').remove();
			  	}

			 });

			   //ここまで同じ処理
			  $children.removeAttr('disabled');		// ステータスを活性状態にする

			   //ステータスのプルダウンに取得した値を入れる
			  document.getElementById('status').value = /*[[${searchRequest.status}]]*/



		}

		//件名
		  document.getElementById('Serch_subject').value = /*[[${searchRequest.serch_subject}]]*/

		// ここまで



		//顧客名のselect要素が変更になるとイベントが発生
		$('.parent').change(function() {
		  //選択された顧客名のvalueを取得し変数に入れる
		  var val1 = $(this).val();

		  //削除された要素をもとに戻すため.html(original)を入れておく
		  $children.html(original).find('option').each(function() {
		    var val2 = $(this).data('val'); //data-valの値を取得
		    //valueと異なるdata-valを持つ要素を削除
		    if (val1 != val2) {
		      $(this).not(':first-child').remove();
		    }

		  });

		  //顧客名のselect要素が未選択の場合、ステータスをdisabledにする
		  if ($(this).val() == "") {
		    $children.attr('disabled', 'disabled');
		  } else {
		    $children.removeAttr('disabled');
		  }

		});
	})
	</script>
</body>
</html>